<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Johniverse Portal ðŸŒŒ</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Roboto',sans-serif;}
body{
  background:#111;
  background-size:cover;
  display:flex;justify-content:center;align-items:flex-start;
  min-height:100vh;color:#fff;
}
.container, #dashboard{
  display:none;
  background: rgba(20,20,20,0.95);
  border-radius:15px;
  box-shadow:0 10px 20px rgba(0,0,0,0.6);
  padding:20px;
  width:90%; max-width:600px;
  margin-top:50px;
  transition:all 0.3s ease;
}
h1,h2,h3{margin-bottom:10px;color:#d7baff;}
input,button,select{
  padding:10px;margin:5px 0;border-radius:5px;border:none;
}
button{
  background:linear-gradient(90deg,#a84eff,#ff4b8d);
  cursor:pointer;font-weight:bold;transition:all 0.2s;
}
button:hover{transform:scale(1.05);opacity:0.9;}
input{width:100%;background:#222;color:#fff;}
#chat-box{height:150px;overflow-y:auto;background:#222;padding:10px;border-radius:10px;margin-bottom:10px;}
.friend-item{padding:5px;margin:2px;background:#333;border-radius:5px;cursor:pointer;}
.friend-item:hover{background:#555;}
#game-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin-top:10px;}
.game-card{background:#222;border-radius:10px;padding:10px;text-align:center;cursor:pointer;transition:0.2s;}
.game-card:hover{transform:scale(1.05);background:#444;}
#pfp{border-radius:50%;border:3px solid #a84eff;width:100px;height:100px;margin-bottom:10px;}
</style>
</head>
<body>

<!-- Login -->
<div class="container" id="login-container">
<h1>Login</h1>
<input type="email" id="login-email" placeholder="Email">
<input type="password" id="login-password" placeholder="Password">
<button onclick="login()">Login</button>
<p style="text-align:center;margin-top:5px;cursor:pointer;color:#a84eff;" onclick="showSignup()">Create Account</p>
</div>

<!-- Signup -->
<div class="container" id="signup-container">
<h1>Sign Up</h1>
<input type="email" id="signup-email" placeholder="Email">
<input type="text" id="signup-username" placeholder="Username">
<input type="password" id="signup-password" placeholder="Password">
<button onclick="signup()">Create Account</button>
<p style="text-align:center;margin-top:5px;cursor:pointer;color:#a84eff;" onclick="showLogin()">Back to Login</p>
</div>

<!-- Dashboard -->
<div id="dashboard">
<h2 id="username-display">Welcome</h2>
<p>Online Users: <span id="online-count">0</span></p>

<img id="pfp" src="https://i.imgur.com/fb7yZkX.png">
<button onclick="changePfp()">Change PFP</button>

<h3>Friends</h3>
<input type="text" id="friend-search" placeholder="Search by email or username" oninput="searchFriends()">
<div id="friend-list"></div>

<h3>Global Chat</h3>
<div id="chat-box"></div>
<input type="text" id="chat-input" placeholder="Type message">
<button onclick="sendChat()">Send</button>

<h3>Games</h3>
<div id="game-container">
  <div class="game-card" onclick="startPingPong()">Ping Pong</div>
  <div class="game-card" onclick="startSnake()">Snake</div>
  <div class="game-card" onclick="startStar()">Click Star</div>
</div>

<button onclick="logout()">Logout</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
// Firebase setup
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

// Random backgrounds
const backgrounds=[
  'https://wallpapercave.com/wp/wp10816761.jpg',
  'https://wallpapercave.com/wp/wp10593829.jpg',
  'https://wallpapercave.com/wp/wp10816750.jpg'
];
function setRandomBackground(){document.body.style.backgroundImage=`url(${backgrounds[Math.floor(Math.random()*backgrounds.length)]})`;}
setRandomBackground();
setInterval(setRandomBackground,10000);

// Show login/signup
function showSignup(){document.getElementById("login-container").style.display="none";document.getElementById("signup-container").style.display="block";}
function showLogin(){document.getElementById("signup-container").style.display="none";document.getElementById("login-container").style.display="block";}

// Signup
function signup(){
  const email=document.getElementById("signup-email").value;
  const username=document.getElementById("signup-username").value;
  const password=document.getElementById("signup-password").value;
  if(!email||!username||!password){alert("Fill all fields!");return;}
  localStorage.setItem(email,JSON.stringify({username,password,pfp:"https://i.imgur.com/fb7yZkX.png"}));
  localStorage.setItem("currentUser",email);
  loadDashboard();
}

// Login
function login(){
  const email=document.getElementById("login-email").value;
  const password=document.getElementById("login-password").value;
  const data=JSON.parse(localStorage.getItem(email));
  if(!data||data.password!==password){alert("Invalid login!");return;}
  localStorage.setItem("currentUser",email);
  loadDashboard();
}

// Dashboard
function loadDashboard(){
  const email=localStorage.getItem("currentUser");
  const data=JSON.parse(localStorage.getItem(email));
  document.getElementById("login-container").style.display="none";
  document.getElementById("signup-container").style.display="none";
  document.getElementById("dashboard").style.display="flex";
  document.getElementById("username-display").innerText="Welcome "+data.username;
  document.getElementById("pfp").src=data.pfp;
  trackOnline(); loadChat(); loadFriends();
}

// Logout
function logout(){localStorage.removeItem("currentUser");location.reload();}

// Change PFP
function changePfp(){
  const input=document.createElement("input"); input.type="file"; input.accept="image/*";
  input.onchange=e=>{
    const file=e.target.files[0]; const reader=new FileReader();
    reader.onload=function(){
      const email=localStorage.getItem("currentUser");
      const data=JSON.parse(localStorage.getItem(email));
      data.pfp=reader.result; localStorage.setItem(email,JSON.stringify(data));
      document.getElementById("pfp").src=reader.result;
    };
    reader.readAsDataURL(file);
  };
  input.click();
}

// Chat
function loadChat(){
  db.ref("chat/").on("value",snap=>{
    const chatBox=document.getElementById("chat-box"); chatBox.innerHTML="";
    const data=snap.val();
    if(data) Object.values(data).forEach(m=>{
      const div=document.createElement("div"); div.textContent=m.user+": "+m.message;
      chatBox.appendChild(div); chatBox.scrollTop=chatBox.scrollHeight;
    });
  });
}
function sendChat(){
  const msg=document.getElementById("chat-input").value; if(!msg) return;
  document.getElementById("chat-input").value="";
  const email=localStorage.getItem("currentUser");
  const username=JSON.parse(localStorage.getItem(email)).username;
  db.ref("chat/").push({user:username,message:msg});
}

// Online users
function trackOnline(){
  const email=localStorage.getItem("currentUser");
  const userRef=db.ref("online/"+email);
  userRef.set(JSON.parse(localStorage.getItem(email)).username);
  userRef.onDisconnect().remove();
  db.ref("online/").on("value",snap=>document.getElementById("online-count").innerText=Object.keys(snap.val()||{}).length);
}

// Friends
function loadFriends(){document.getElementById("friend-list").innerHTML="";}
function searchFriends(){
  const val=document.getElementById("friend-search").value.toLowerCase();
  const list=document.getElementById("friend-list"); list.innerHTML="";
  Object.keys(localStorage).forEach(key=>{
    if(key==="currentUser") return;
    const user=JSON.parse(localStorage.getItem(key));
    if(user.username.toLowerCase().startsWith(val)||key.toLowerCase().startsWith(val)){
      const div=document.createElement("div"); div.className="friend-item";
      div.textContent=user.username+" ("+key+")"; div.onclick=()=>alert("Friend request sent to "+user.username);
      list.appendChild(div);
    }
  });
}

// Auto-login
if(localStorage.getItem("currentUser")) loadDashboard();

// Games placeholders
function clearGames(){document.getElementById("game-container").innerHTML='<div class="game-card" onclick="startPingPong()">Ping Pong</div><div class="game-card" onclick="startSnake()">Snake</div><div class="game-card" onclick="startStar()">Click Star</div>';}
function startPingPong(){alert("Ping Pong game will appear here");}
function startSnake(){alert("Snake game will appear here");}
function startStar(){alert("Click Star game will appear here");}
</script>
</body>
</html>
